"use strict";!function(){function e(e){this.init(e)}function r(e,r){this.init(e,r)}var t=function(e){return JSON.parse(String.fromCharCode.apply(null,new Uint16Array(e)))},o=function(e){for(var r=JSON.stringify(e),t=new ArrayBuffer(2*r.length),o=new Uint16Array(t),n=0,i=r.length;n<i;n++)o[n]=r.charCodeAt(n);return o};window.WorkerOvserve=window.WorkerOvserve||function(){function e(){this._Map=new Map}return e.prototype.observe=function(e,r){var t=this._Map.get(e)||[];t.push(r),this._Map.set(e,t)},e.prototype.unobserve=function(e,r){var t=this._Map.get(e)||[];this._Map.set(e,t.filter(function(e){return e!==r}))},e.prototype.notify=function(e){var r=Array.prototype.slice.call(arguments,1);(this._Map.get(e)||[]).forEach(function(e,t){e.apply(null,r)})},new e}();var n={CHIRIMEN:{PORTS:{283:{portName:"CN1.UART3_RX",pinName:"4"},284:{portName:"CN1.UART3_TX",pinName:"5"},196:{portName:"CN1.SPI0_CS",pinName:"7"},197:{portName:"CN1.SPI0_CLK",pinName:"8"},198:{portName:"CN1.SPI0_RX",pinName:"9"},199:{portName:"CN1.SPI0_TX",pinName:"10"},244:{portName:"CN1.SPI1_CS",pinName:"11"},243:{portName:"CN1.SPI1_CLK",pinName:"12"},246:{portName:"CN1.SPI1_RX",pinName:"13"},245:{portName:"CN1.SPI1_TX",pinName:"14"},163:{portName:"CN2.PWM0",pinName:"10"},193:{portName:"CN2.UART0_TX",pinName:"13"},192:{portName:"CN2.UART0_RX",pinName:"14"},353:{portName:"CN2.GPIO6_A1",pinName:"15"}},I2C_PORTS:{0:{SDA:{portName:"CN2.I2C0_SCL",pinName:"11"},SCL:{portName:"CN2.I2C0_SDA",pinName:"12"}},2:{SDA:{portName:"CN1.I2C2_SDA",pinName:"2"},SCL:{portName:"CN1.I2C2_SCL",pinName:"3"}}}}},i=function(e){this.init(e)};i.prototype={init:function(r){var t=this;this.ports=new s;var o=function(e){return parseInt(e,10)},i=function(r){return t.ports.set(r,new e(r))};Object.keys(n.CHIRIMEN.I2C_PORTS).map(o).forEach(i)},ports:null},e.prototype={init:function(e){this.portNumber=e,window.WorkerOvserve.notify("i2c",{method:"i2c.open",portNumber:this.portNumber})},portNumber:0,open:function(e){var t=this;return new Promise(function(o,n){o(new r(t.portNumber,e))})}};var s=Map;if(r.prototype={init:function(e,r){var t=this;this.portNumber=e,this.slaveAddress=r,window.WorkerOvserve.notify("i2c",{method:"i2c.setDeviceAddress",portNumber:this.portNumber,slaveAddress:this.slaveAddress}),window.WorkerOvserve.observe("i2c.setDeviceAddress."+this.portNumber,function(e){t.slaveDevice=e.slaveDevice})},portNumber:void 0,slaveAddress:void 0,slaveDevice:void 0,read8:function(e){var r=this;return new Promise(function(t,o){window.WorkerOvserve.notify("i2c",{method:"i2c.read",portNumber:r.portNumber,readRegistar:e,aIsOctet:!0}),window.WorkerOvserve.observe("i2c.read."+r.portNumber+"."+e,function(e){return t(e.value)})})},read16:function(e){var r=this;return new Promise(function(t,o){window.WorkerOvserve.notify("i2c",{method:"i2c.read",portNumber:r.portNumber,readRegistar:e,aIsOctet:!1}),window.WorkerOvserve.observe("i2c.read."+r.portNumber+"."+e,function(e){return t(e.value)})})},write8:function(e,r){var t=this;return new Promise(function(o,n){window.WorkerOvserve.notify("i2c",{method:"i2c.write",portNumber:t.portNumber,registerNumber:e,value:r,aIsOctet:!0}),window.WorkerOvserve.observe("i2c.write."+t.portNumber+"."+e,function(e){o(e.value)})})},write16:function(e,r){var t=this;return new Promise(function(o,n){window.WorkerOvserve.notify("i2c",{method:"i2c.write",portNumber:t.portNumber,registerNumber:e,value:r,aIsOctet:!1}),window.WorkerOvserve.observe("i2c.write."+t.portNumber+"."+e,function(e){o(e.value)})})}},navigator.requestI2CAccess||(navigator.requestI2CAccess=function(){return Promise.resolve(new i)}),window.Worker&&window.WorkerOvserve){var a=function(){if(document.currentScript)return document.currentScript.src;var e=document.getElementsByTagName("script"),r=e[e.length-1];return r.src?r.src:void 0}(),u=new Worker(a.substr(0,a.lastIndexOf("/"))+"/worker.i2c.js");window.WorkerOvserve.observe("gpio",function(e){var r=o(e);u.postMessage(r.buffer,[r.buffer])}),window.WorkerOvserve.observe("i2c",function(e){var r=o(e);u.postMessage(r.buffer,[r.buffer])}),u.onmessage=function(e){var r=t(e.data);window.WorkerOvserve.notify(r.method,r)}}}();