"use strict";!function(){function e(e){this.init(e)}function r(e,r){var t=this;return new Promise(function(o,i){t.init(e,r).then(function(){o(t)},function(e){i(e)})})}var t=function(e){return JSON.parse(String.fromCharCode.apply(null,new Uint16Array(e)))},o=function(e){for(var r=JSON.stringify(e),t=new ArrayBuffer(2*r.length),o=new Uint16Array(t),i=0,n=r.length;i<n;i++)o[i]=r.charCodeAt(i);return o};window.WorkerOvserve=window.WorkerOvserve||function(){function e(){this._Map=new Map}return e.prototype.observe=function(e,r){var t=this._Map.get(e)||[];t.push(r),this._Map.set(e,t)},e.prototype.unobserve=function(e,r){var t=this._Map.get(e)||[];this._Map.set(e,t.filter(function(e){return e!==r}))},e.prototype.notify=function(e){var r=Array.prototype.slice.call(arguments,1);(this._Map.get(e)||[]).forEach(function(e,t){e.apply(null,r)})},e.prototype["delete"]=function(e){this._Map["delete"](e)},new e}();var i={CHIRIMEN:{PORTS:{283:{portName:"CN1.UART3_RX",pinName:"4"},284:{portName:"CN1.UART3_TX",pinName:"5"},196:{portName:"CN1.SPI0_CS",pinName:"7"},197:{portName:"CN1.SPI0_CLK",pinName:"8"},198:{portName:"CN1.SPI0_RX",pinName:"9"},199:{portName:"CN1.SPI0_TX",pinName:"10"},244:{portName:"CN1.SPI1_CS",pinName:"11"},243:{portName:"CN1.SPI1_CLK",pinName:"12"},246:{portName:"CN1.SPI1_RX",pinName:"13"},245:{portName:"CN1.SPI1_TX",pinName:"14"},163:{portName:"CN2.PWM0",pinName:"10"},193:{portName:"CN2.UART0_TX",pinName:"13"},192:{portName:"CN2.UART0_RX",pinName:"14"},353:{portName:"CN2.GPIO6_A1",pinName:"15"}},I2C_PORTS:{0:{SDA:{portName:"CN2.I2C0_SCL",pinName:"11"},SCL:{portName:"CN2.I2C0_SDA",pinName:"12"}},2:{SDA:{portName:"CN1.I2C2_SDA",pinName:"2"},SCL:{portName:"CN1.I2C2_SCL",pinName:"3"}}}}},n=function(e){this.init(e)};n.prototype={init:function(r){var t=this;this.ports=new s;var o=function(e){return parseInt(e,10)},n=function(r){return t.ports.set(r,new e(r))};Object.keys(i.CHIRIMEN.I2C_PORTS).map(o).forEach(n)},ports:null},e.prototype={init:function(e){this.portNumber=e,window.WorkerOvserve.notify("i2c",{method:"i2c.open",portNumber:this.portNumber})},portNumber:0,open:function(e){var t=this;return new Promise(function(o,i){new r(t.portNumber,e).then(function(e){o(e)},function(e){i(e)})})}};var s=Map;if(r.prototype={init:function(e,r){var t=this;return new Promise(function(o,i){t.portNumber=e,t.slaveAddress=r,window.WorkerOvserve.notify("i2c",{method:"i2c.setDeviceAddress",portNumber:t.portNumber,slaveAddress:t.slaveAddress}),window.WorkerOvserve.observe("i2c.setDeviceAddress."+t.portNumber,function(e){e.error?(console.log("i2c.setDeviceAddress: error name:["+e.error.name+"]"),i(e.error)):(t.slaveDevice=e.slaveDevice,o(e.slaveDevice)),window.WorkerOvserve["delete"]("i2c.setDeviceAddress."+t.portNumber)})})},getXid:function(){return this.xid++,this.xid>999&&(this.xid=0),this.xid},xid:0,portNumber:void 0,slaveAddress:void 0,slaveDevice:void 0,read8:function(e){var r=this;return new Promise(function(t,o){var i=r.getXid();window.WorkerOvserve.notify("i2c",{method:"i2c.read",xid:i,portNumber:r.portNumber,slaveAddress:r.slaveAddress,readRegistar:e,aIsOctet:!0}),window.WorkerOvserve.observe("i2c.read."+i+"."+r.portNumber+"."+r.slaveAddress+"."+e,function(n){n.error?(console.log("i2c.read8: error name:["+n.error.name+"]"),o(n.error)):t(n.value),window.WorkerOvserve["delete"]("i2c.read."+i+"."+r.portNumber+"."+r.slaveAddress+"."+e)})})},read16:function(e){var r=this;return new Promise(function(t,o){var i=r.getXid();window.WorkerOvserve.notify("i2c",{method:"i2c.read",xid:i,portNumber:r.portNumber,slaveAddress:r.slaveAddress,readRegistar:e,aIsOctet:!1}),window.WorkerOvserve.observe("i2c.read."+i+"."+r.portNumber+"."+r.slaveAddress+"."+e,function(n){n.error?(console.log("i2c.read16: error name:["+n.error.name+"]"),o(n.error)):t(n.value),window.WorkerOvserve["delete"]("i2c.read."+i+"."+r.portNumber+"."+r.slaveAddress+"."+e)})})},write8:function(e,r){var t=this;return new Promise(function(o,i){var n=t.getXid();window.WorkerOvserve.notify("i2c",{method:"i2c.write",xid:n,portNumber:t.portNumber,slaveAddress:t.slaveAddress,registerNumber:e,value:r,aIsOctet:!0}),window.WorkerOvserve.observe("i2c.write."+n+"."+t.portNumber+"."+t.slaveAddress+"."+e,function(r){r.error?(console.log("i2c.write8: error name:["+r.error.name+"]"),i(r.error)):o(r.value),window.WorkerOvserve["delete"]("i2c.write."+n+"."+t.portNumber+"."+t.slaveAddress+"."+e)})})},write16:function(e,r){var t=this;return new Promise(function(o,i){var n=t.getXid();window.WorkerOvserve.notify("i2c",{method:"i2c.write",xid:n,portNumber:t.portNumber,slaveAddress:t.slaveAddress,registerNumber:e,value:r,aIsOctet:!1}),window.WorkerOvserve.observe("i2c.write."+n+"."+t.portNumber+"."+t.slaveAddress+"."+e,function(r){r.error?(console.log("i2c.write16: error name:["+r.error.name+"]"),i(r.error)):o(r.value),window.WorkerOvserve["delete"]("i2c.write."+n+"."+t.portNumber+"."+t.slaveAddress+"."+e)})})}},navigator.requestI2CAccess||(navigator.requestI2CAccess=function(){return Promise.resolve(new n)}),window.Worker&&window.WorkerOvserve){var a=function(){if(document.currentScript)return document.currentScript.src;var e=document.getElementsByTagName("script"),r=e[e.length-1];return r.src?r.src:void 0}(),d=new Worker(a.substr(0,a.lastIndexOf("/"))+"/worker.i2c.js");window.WorkerOvserve.observe("i2c",function(e){var r=o(e);d.postMessage(r.buffer,[r.buffer])}),d.onmessage=function(e){var r=t(e.data);window.WorkerOvserve.notify(r.method,r)}}}();